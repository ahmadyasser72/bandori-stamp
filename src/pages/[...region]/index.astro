---
import type { GetStaticPaths } from "astro";
import { getEntry } from "astro:content";
import { getCollection } from "astro:content";

import BandoriStampPlayground from "~/components/svelte/bandori-stamp-playground.svelte";
import { REGIONS } from "~/constants";
import DefaultLayout from "~/layouts/default-layout.astro";

export const getStaticPaths = (() => [
  { params: { region: undefined } },
  ...REGIONS.map((region) => ({ params: { region } })),
]) satisfies GetStaticPaths;

const { region } = Astro.params;

const title =
  region === undefined
    ? "Bandori Stamp"
    : `Bandori Stamp (${region.toUpperCase()})`;

const members = await Promise.all(
  (await getCollection("members")).map(async ({ data }) => ({
    ...data,
    band: (await getEntry("bands", data.band.id))!.data,
  }))
);
const stamps = (
  await getCollection(
    "stamps",
    ({ data }) => region === undefined || data.region === region
  )
)
  .map(({ data }) => data)
  .sort((a, b) => a.stampId.localeCompare(b.stampId));
---

<DefaultLayout {title}>
  <BandoriStampPlayground {members} {stamps} client:load />
</DefaultLayout>
